#include <dt-bindings/zmk/input_transform.h>
#include <input/processors.dtsi>

#define WIN 1
#define SYMBOLS 2
#define NUMBERS 18
#define NAV 4
#define FUNCTION 5
#define BLUETOOTH 6
#define MOUSE 7
#define CLICK 8
#define SCRL 9
#define BIRO 10

/ {
  split_inputs {
    #address-cells = <1>;
    #size-cells = <0>;

    trackball_split: trackball_split@0 {
      compatible = "zmk,input-split";
      reg = <0>;
    };
    trackball_split2: trackball_split2@1 {
      compatible = "zmk,input-split";
      reg = <1>;
    };
  };

  // 右手：座標変換を最適化してカーソル移動の精度を向上
  trackball_listener: trackball_listener {
    compatible = "zmk,input-listener";
    status = "disabled";
    device = <&trackball_split>;
    
    // デフォルト: Y軸を反転して正しい方向に動くように調整
    input-processors = <&zip_xy_transform (INPUT_TRANSFORM_Y_INVERT)>;
    
    // レイヤー1,2で縦スクロール（より敏感な設定）
    scroll {
      layers = <1 2>;
      input-processors = <&zip_xy_transform (INPUT_TRANSFORM_Y_INVERT)>, <&zip_xy_scaler 1 150>, <&zip_xy_to_scroll_mapper>;
    };
  };

  // 左手：レイヤー別スクロール方向切り替え（設定を微調整）
  trackball_listener2: trackball_listener2 {
    compatible = "zmk,input-listener";
    status = "disabled";
    device = <&trackball_split2>;
    
    // デフォルト（レイヤー0）：縦スクロール限定、より敏感に
    input-processors = <&zip_xy_transform (INPUT_TRANSFORM_XY_SWAP | INPUT_TRANSFORM_Y_INVERT)>, <&zip_xy_scaler 1 150>, <&zip_xy_to_scroll_mapper>;
    
    // レイヤー1：縦スクロール限定（デフォルトと同じ、敏感度向上）
    scroll {
      layers = <1>;
      input-processors = <&zip_xy_transform (INPUT_TRANSFORM_XY_SWAP | INPUT_TRANSFORM_Y_INVERT)>, <&zip_xy_scaler 1 150>, <&zip_xy_to_scroll_mapper>;
    };
    
    // レイヤー2：横スクロール限定（敏感度向上）
    horizontal_scroll {
      layers = <2>;
      input-processors = <&zip_xy_transform (INPUT_TRANSFORM_Y_INVERT)>, <&zip_xy_scaler 150 1>, <&zip_xy_to_scroll_mapper>;
    };
  };
};
